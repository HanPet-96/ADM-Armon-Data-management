from __future__ import annotations


LANGUAGES = ("en", "nl")

TRANSLATIONS: dict[str, dict[str, str]] = {
    "en": {
        "lang_name_en": "English",
        "lang_name_nl": "Dutch",
        "window_title": "ADM - Armon Data Management v{version}",
        "btn_reindex": "Re-index",
        "btn_unlinked": "Unlinked docs",
        "btn_order_list": "Order list",
        "btn_settings": "Settings",
        "btn_help": "?",
        "tooltip_help": "Open user guide",
        "search_placeholder": "Search article / part / description",
        "btn_search": "Search",
        "btn_expand_all": "Expand all",
        "btn_collapse_all": "Collapse all",
        "btn_add_to_order": "Add to order",
        "lbl_select_article": "Select an article",
        "lbl_docs_article": "Linked documents (article)",
        "lbl_pdf_preview": "PDF preview",
        "lbl_preview_default": "Select a BOM line with exactly one linked PDF.",
        "btn_close": "Close",
        "btn_clear": "Clear",
        "btn_export_xlsx_zip": "Export XLSX + ZIP",
        "order_title": "Order list",
        "order_tbl_part": "Part NR",
        "order_tbl_rev": "Rev",
        "order_tbl_qty": "Qty",
        "bom_col_item": "Item",
        "bom_col_part": "Part NR",
        "bom_col_rev": "Rev",
        "bom_col_desc": "Description",
        "bom_col_material": "Material",
        "bom_col_finish": "Finish",
        "bom_col_qty": "Qty",
        "bom_col_type": "Type",
        "bom_col_status": "Status",
        "article_col_article": "Article",
        "article_col_title": "Title",
        "article_col_bom_lines": "BOM lines",
        "settings_title": "Settings",
        "settings_datastruct": "Datastruct folder",
        "settings_browse": "Browse...",
        "settings_dark_mode": "Dark mode",
        "settings_language": "Language",
        "settings_check_updates": "Check for updates",
        "settings_save": "Save",
        "settings_cancel": "Cancel",
        "update_check_title": "Update check",
        "update_check_failed": "Latest version could not be retrieved from GitHub.",
        "update_available_title": "Update available",
        "update_available_msg": "Installed version: {installed}\nLatest version: {latest}\n\nOpen releases page now?",
        "up_to_date_title": "Up to date",
        "up_to_date_msg": "You are on the latest version ({version}).",
        "unlinked_title": "Unlinked documents",
        "unlinked_col_filename": "Filename",
        "unlinked_col_reason": "Reason",
        "unlinked_col_path": "Path",
        "part_title": "Part: {part_number}",
        "part_type": "Part type: {part_type}",
        "part_docs": "Documents",
        "order_select_first": "Select a BOM item first.",
        "order_include_title": "What would you like to include?",
        "order_include_label": "Select option:",
        "order_include_selected": "Selected only",
        "order_include_children": "Children only",
        "order_include_both": "Selected + children",
        "order_qty_title": "Order quantity",
        "order_qty_label": "How many assemblies to add?",
        "order_added_title": "Order",
        "order_added_msg": "Added {count} leaf part line(s) to order list.{warnings}",
        "order_export_empty": "Order list is empty.",
        "order_export_select_folder": "Select export folder",
        "order_export_done_title": "Order export complete",
        "order_export_done_msg": "XLSX: {xlsx}\nDocs copied: {docs}\nZIP: {zip_path}",
        "order_clear_title": "Clear order list",
        "order_clear_msg": "Clear all items in the order list?",
        "order_remove_parent_title": "Remove parent line",
        "order_remove_parent_msg": "This parent has {count} child line(s). Remove all children too?",
        "settings_invalid_title": "Invalid setting",
        "settings_invalid_empty": "Datastruct folder cannot be empty.",
        "settings_invalid_not_exists": "Selected Datastruct folder does not exist.",
        "settings_saved_title": "Settings saved",
        "settings_saved_reindex": "Datastruct path updated. Re-index now?",
        "reindex_done_title": "Re-index complete",
        "reindex_done_msg": "BOMs: {boms}\nLines: {lines}\nWarnings: {warnings}\nErrors: {errors}",
        "help_not_found_title": "User guide not found",
        "help_not_found_msg": "README_EXE_GEBRUIK.pdf was not found next to the app.",
        "preview_no_pdf": "No PDF found in linked documents.",
        "preview_not_pdf": "Selected document is not a PDF.",
        "preview_no_selected": "No PDF selected.",
        "preview_component_missing": "PDF preview component is not available in this environment.",
        "preview_failed_load": "Failed to load PDF preview ({result}).",
        "preview_failed_load_generic": "Failed to load PDF preview.",
        "root_label": "ROOT",
        "root_type": "article",
        "warn_max_depth": "Maximum subassembly depth reached (20).",
        "warn_missing_subassembly": "Missing subassembly target for {part}.",
        "warn_subassembly_no_lines": "Subassembly article {article_id} has no BOM lines.",
        "warn_cycle_detected": "Cycle detected on article ref {part}.",
        "warn_section": "\n\nWarnings:\n- {items}",
    },
    "nl": {
        "lang_name_en": "Engels",
        "lang_name_nl": "Nederlands",
        "window_title": "ADM - Armon Data Management v{version}",
        "btn_reindex": "Herindexeren",
        "btn_unlinked": "Ongekoppelde docs",
        "btn_order_list": "Bestellijst",
        "btn_settings": "Instellingen",
        "btn_help": "?",
        "tooltip_help": "Gebruikershandleiding openen",
        "search_placeholder": "Zoek op artikel / part / omschrijving",
        "btn_search": "Zoeken",
        "btn_expand_all": "Alles uitklappen",
        "btn_collapse_all": "Alles inklappen",
        "btn_add_to_order": "Aan bestelling toevoegen",
        "lbl_select_article": "Selecteer een artikel",
        "lbl_docs_article": "Gekoppelde documenten (artikel)",
        "lbl_pdf_preview": "PDF voorbeeld",
        "lbl_preview_default": "Selecteer een BOM-regel met precies één gekoppelde PDF.",
        "btn_close": "Sluiten",
        "btn_clear": "Wissen",
        "btn_export_xlsx_zip": "Exporteer XLSX + ZIP",
        "order_title": "Bestellijst",
        "order_tbl_part": "Part NR",
        "order_tbl_rev": "Rev",
        "order_tbl_qty": "Aantal",
        "bom_col_item": "Item",
        "bom_col_part": "Part NR",
        "bom_col_rev": "Rev",
        "bom_col_desc": "Omschrijving",
        "bom_col_material": "Materiaal",
        "bom_col_finish": "Afwerking",
        "bom_col_qty": "Aantal",
        "bom_col_type": "Type",
        "bom_col_status": "Status",
        "article_col_article": "Artikel",
        "article_col_title": "Titel",
        "article_col_bom_lines": "BOM regels",
        "settings_title": "Instellingen",
        "settings_datastruct": "Datastruct map",
        "settings_browse": "Bladeren...",
        "settings_dark_mode": "Donkere modus",
        "settings_language": "Taal",
        "settings_check_updates": "Controleer updates",
        "settings_save": "Opslaan",
        "settings_cancel": "Annuleren",
        "update_check_title": "Updatecontrole",
        "update_check_failed": "Nieuwste versie kon niet van GitHub worden opgehaald.",
        "update_available_title": "Update beschikbaar",
        "update_available_msg": "Geïnstalleerde versie: {installed}\nNieuwste versie: {latest}\n\nReleasespagina nu openen?",
        "up_to_date_title": "Up-to-date",
        "up_to_date_msg": "Je gebruikt de nieuwste versie ({version}).",
        "unlinked_title": "Ongekoppelde documenten",
        "unlinked_col_filename": "Bestandsnaam",
        "unlinked_col_reason": "Reden",
        "unlinked_col_path": "Pad",
        "part_title": "Part: {part_number}",
        "part_type": "Part type: {part_type}",
        "part_docs": "Documenten",
        "order_select_first": "Selecteer eerst een BOM-item.",
        "order_include_title": "Wat wil je toevoegen?",
        "order_include_label": "Kies optie:",
        "order_include_selected": "Alleen selectie",
        "order_include_children": "Alleen children",
        "order_include_both": "Selectie + children",
        "order_qty_title": "Bestelhoeveelheid",
        "order_qty_label": "Hoeveel assemblies toevoegen?",
        "order_added_title": "Bestelling",
        "order_added_msg": "{count} leaf part regel(s) toegevoegd aan de bestellijst.{warnings}",
        "order_export_empty": "Bestellijst is leeg.",
        "order_export_select_folder": "Kies exportmap",
        "order_export_done_title": "Bestelling geëxporteerd",
        "order_export_done_msg": "XLSX: {xlsx}\nGekopieerde docs: {docs}\nZIP: {zip_path}",
        "order_clear_title": "Bestellijst wissen",
        "order_clear_msg": "Alle items in de bestellijst wissen?",
        "order_remove_parent_title": "Parentregel verwijderen",
        "order_remove_parent_msg": "Deze parent heeft {count} child regel(s). Ook alle children verwijderen?",
        "settings_invalid_title": "Ongeldige instelling",
        "settings_invalid_empty": "Datastruct map mag niet leeg zijn.",
        "settings_invalid_not_exists": "Geselecteerde Datastruct map bestaat niet.",
        "settings_saved_title": "Instellingen opgeslagen",
        "settings_saved_reindex": "Datastruct pad aangepast. Nu herindexeren?",
        "reindex_done_title": "Herindexeren voltooid",
        "reindex_done_msg": "BOMs: {boms}\nRegels: {lines}\nWaarschuwingen: {warnings}\nFouten: {errors}",
        "help_not_found_title": "Handleiding niet gevonden",
        "help_not_found_msg": "README_EXE_GEBRUIK.pdf is niet gevonden naast de app.",
        "preview_no_pdf": "Geen PDF gevonden in gekoppelde documenten.",
        "preview_not_pdf": "Geselecteerd document is geen PDF.",
        "preview_no_selected": "Geen PDF geselecteerd.",
        "preview_component_missing": "PDF-previewcomponent is niet beschikbaar in deze omgeving.",
        "preview_failed_load": "PDF preview laden mislukt ({result}).",
        "preview_failed_load_generic": "PDF preview laden mislukt.",
        "root_label": "ROOT",
        "root_type": "artikel",
        "warn_max_depth": "Maximale subassembly diepte bereikt (20).",
        "warn_missing_subassembly": "Subassembly-doel ontbreekt voor {part}.",
        "warn_subassembly_no_lines": "Subassembly artikel {article_id} heeft geen BOM-regels.",
        "warn_cycle_detected": "Cycle gedetecteerd op artikelref {part}.",
        "warn_section": "\n\nWaarschuwingen:\n- {items}",
    },
}


def normalize_language(language: str) -> str:
    lang = str(language or "en").lower().strip()
    return lang if lang in LANGUAGES else "en"


def tr(language: str, key: str, **kwargs) -> str:
    lang = normalize_language(language)
    value = TRANSLATIONS.get(lang, {}).get(key) or TRANSLATIONS["en"].get(key) or key
    try:
        return value.format(**kwargs)
    except Exception:
        return value
